#! /bin/sh

# file      : tester.in
# copyright : Copyright (c) 2009-2012 Code Synthesis Tools CC
# license   : GNU GPL v2; see accompanying LICENSE file

#
# Run an ODB test. The test driver is in the current directory. The
# data files, if any, are in $srcdir.
#

# Globbing returns files in alphabetic order.
#
for f in `echo *.sql`; do
  if test -f $f; then
    $top_builddir/db-driver $f

    if test $? -ne 0; then
      exit 1
    fi
  fi
done

echo ./driver --options-file "$top_builddir/db.options"

if test -f "$srcdir/test.std"; then
  ./driver --options-file "$top_builddir/db.options" >test.out

  if test $? -ne 0; then
    exit 1
  fi

  @DIFF@ @DIFFFLAGS@ "$srcdir/test.std" test.out
  r=$?
  rm -f test.out
  exit $r
else
  ./driver --options-file "$top_builddir/db.options"
fi
